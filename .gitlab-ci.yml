# ===== DEFINE DEFAULT DOCKER IMAGE =====
# dockerhub image generated using docker/Dockerfile_simple
image: rinkdtu/topfarm-ci:latest


# ===== TEST TOPFARM =====
test_topfarm:  # name the job what we like
  stage:  # build, test, deploy defined by default [2]
    test
  script:
  - pip install --upgrade git+git://github.com/FUSED-Wind/FUSED-Wake@master
  - cd tests; py.test
  tags:  # only runners with this tag can do the job [3]
  - python


# ===== TEST TOPFARM on Windows =====
test_topfarm_windows:  # name the job what we like
  variables:
    GIT_SUBMODULE_STRATEGY: normal
  stage:  # build, test, deploy defined by default [2]
    test
  script:  # runs on windows machine due to tag below
  - cd tests
  - c:/Anaconda3/envs/pyTopfarm/python.exe -m pytest --cov-report term-missing:skip-covered --cov=../topfarm --cov-config ../.coveragerc
  tags:  # tag for shared runner on windows machine
  - CPAV_old_PC

# ===== BUILD DOCS AND PUSH TO PUBLIC WEBSITE =====
pages:  # "pages" is a job specifically for GitLab pages [1]
  stage:  # build, test, deploy defined by default [2]
    deploy
  script:  # use sphinx to build docs, move to public page
  - cd docs; make html
  - cd ../; mv docs/build/html public/
  artifacts:  # required for GitLab pages [1]
    paths:
    - public
  only:  # only run for these branches
  - master
  tags:  # only runners with this tag can do the job [3]
  - python


# [1] GitLab page: https://docs.gitlab.com/ee/ci/yaml/#pages
# [2] CI stages: https://docs.gitlab.com/ee/ci/yaml/#stages
# [3] Tags: https://docs.gitlab.com/ee/ci/yaml/#tags